var b=[],d=new Map,Y=0,m=!0;function J(){return`signal_${++Y}_${Date.now()}`}function D(e,n,t){let r={id:J(),type:e,createdAt:Date.now(),label:t};if(d.set(r.id,r),m){for(let o of b)if(o.onSignalCreate)try{o.onSignalCreate(r,n)}catch(a){console.error(`Error in plugin "${o.name}" onSignalCreate:`,a)}}return r}function V(e,n,t,r="set"){if(!m)return;let o=d.get(e);if(!o)return;let a={signal:o,oldValue:n,newValue:t,timestamp:Date.now(),source:r};for(let l of b)if(l.onSignalUpdate)try{l.onSignalUpdate(a)}catch(Z){console.error(`Error in plugin "${l.name}" onSignalUpdate:`,Z)}}function I(e){if(!m)return;let n=d.get(e);if(n){for(let t of b)if(t.onSignalDestroy)try{t.onSignalDestroy(n)}catch(r){console.error(`Error in plugin "${t.name}" onSignalDestroy:`,r)}d.delete(e)}}var s=1,S=2,v=4,T=8,R=16,k=1e4,A=new Array(k),p=0;function K(e){p<k&&(e.value=void 0,e.subscribers=null,e.listeners=null,e.dependencies=null,e.computeFn=null,e.flags=0,A[p++]=e)}var f=new WeakMap,B=new Map;var _=1e4,F=new Array(_),u=0,c=0,h=!1;function X(e){if(e.flags&S)return;let n=(c+1)%_;n===u&&(console.error("[SignalForge] Batch queue overflow \u2192 forcing flush"),U()),e.flags|=S,F[c]=e,c=n,h||(h=!0,queueMicrotask(U))}function U(){for(h=!1;u!==c;){let e=F[u];u=(u+1)%_,e.flags&=~S,e.flags&s&&g(e)}}var L=new Array(100),H=0,i=null;function ee(e){L[H++]=i,i=e}function ne(){i=L[--H]}var te=function(){return this._node.value},re=function(e){this._node.subscribers||(this._node.subscribers=new Set),this._node.subscribers.add(e)},oe=function(e){this._node.subscribers&&this._node.subscribers.delete(e)};function x(e,n=null){let t=p>0?A[--p]:{value:void 0,subscribers:null,listeners:null,dependencies:null,computeFn:null,flags:0};return t.value=e,t.computeFn=n,t.flags=n?R|s:0,n&&g(t),t}function N(e,n){return i?(i!==e&&(q(e,i),se(i,n)),e.flags&s&&e.computeFn&&g(e),e.value):(e.flags&s&&e.computeFn&&g(e),e.value)}function ie(e,n,t){if(e.flags&R)throw new Error("Cannot set computed signal");if(typeof t=="function"&&(t=t(e.value)),Object.is(t,e.value))return;let r=e.value;e.value=t;let o=f.get(n);o&&V(o,r,t,"set"),j(e)}function q(e,n){e.subscribers||(e.subscribers=new Set),e.subscribers.add(n)}function ae(e,n){e.subscribers&&e.subscribers.delete(n)}function se(e,n){e.dependencies||(e.dependencies=new Set),e.dependencies.has(n)||(e.dependencies.add(n),q(n._node,e))}function G(e){if(e.dependencies){for(let n of e.dependencies)ae(n._node,e);e.dependencies.clear()}}function w(e){if(!(e.flags&s)&&(e.flags|=s,X(e),e.subscribers))for(let n of e.subscribers)w(n)}function g(e){if(e.computeFn&&!(e.flags&v)){e.flags|=v,G(e),ee(e);try{let n=e.computeFn();e.flags&=~s,e.flags&=~v,Object.is(n,e.value)||(e.value=n,j(e))}finally{ne()}}}function j(e){if(e.subscribers)for(let n of e.subscribers)w(n);if(e.flags&T&&e.listeners)for(let n of e.listeners)n(e.value)}function O(e,n){return e.listeners||(e.listeners=new Set),e.listeners.add(n),e.flags|=T,()=>{e.listeners.delete(n),e.listeners.size===0&&(e.flags&=~T)}}function P(e){G(e),e.subscribers&&e.subscribers.clear(),e.listeners&&e.listeners.clear(),K(e)}function E(e){let n=x(e,null),t={get:()=>N(n,t),set:o=>ie(n,t,o),subscribe:o=>O(n,o),destroy:()=>{let o=f.get(t);o&&(I(o),B.delete(o),f.delete(t)),P(n)},_node:n,_peek:te,_addSubscriber:re,_removeSubscriber:oe},r=D("signal",e);return f.set(t,r.id),B.set(r.id,t),t}function le(e){let n,t=i;i=null;try{n=e()}finally{i=t}let r=x(n,e),o={get:()=>N(r,o),set:()=>{throw new Error("Cannot set computed signal")},subscribe:a=>O(r,a),destroy:()=>P(r),_node:r,_peek:()=>r.value,_addSubscriber:a=>{r.subscribers||(r.subscribers=new Set),r.subscribers.add(a)},_removeSubscriber:a=>{r.subscribers&&r.subscribers.delete(a)},_markDirty:()=>w(r),_recompute:()=>g(r)};return o}function C(e){let n=x(void 0,e);return()=>P(n)}function ue(e){let n=e();return W(),n}function W(){u!==c&&U()}function ce(e){let n=i;i=null;try{return e()}finally{i=n}}var ge=W;import{useState as M,useEffect as z}from"react";function de(){if(typeof M!="function"||typeof z!="function")throw new Error(`[SignalForge] React hooks unavailable. Possible duplicate React instance or invalid bundler resolution.
Troubleshooting:
  1. Ensure only one react copy: node_modules/react (no nested copy under library).
  2. Clear Metro cache: npx react-native start --reset-cache.
  3. Verify metro.config.js extraNodeModules maps react to example app node_modules.`)}de();function Q(e){let[n,t]=M(()=>e.get());return z(()=>(t(e.get()),e.subscribe(()=>t(e.get()))),[e]),n}function fe(e){let[n]=M(()=>{let r=typeof e=="function"?e():e;return E(r)});return[Q(n),n.set.bind(n)]}import{useEffect as pe,useRef as $}from"react";var y=new WeakMap;function ye(e,n=[]){let t=$({}),r=$(null),o=$(null);pe(()=>{let a=()=>{if(!y.get(t.current)){y.set(t.current,!0);try{r.current&&(r.current(),r.current=null);let l=e();typeof l=="function"&&(r.current=l)}finally{y.set(t.current,!1)}}};return o.current=C(a),()=>{r.current&&r.current(),o.current&&o.current(),y.delete(t.current)}},n)}export{ue as batch,le as createComputed,C as createEffect,E as createSignal,ge as flushSync,ce as untrack,fe as useSignal,ye as useSignalEffect,Q as useSignalValue};
